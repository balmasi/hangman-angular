function contains(arr,obj) {
  return (arr.indexOf(obj) != -1);
}

String.prototype.replaceAt = function(index,c){
  var a = this.split("");
  a[index] = c;
  return a.join("");
}

function HangmanCtrl($scope) {
  $scope.lives = 0;
  $scope.inputText = "";
  $scope.gameStarted = false;
  
  $scope.chooseWordRandomly = function() {
    var words = [
    "RETROSPECTIVE",
    "AGILE",
    "SCRUM",
    "ITERATION",
    "PRODUCT", 
    "OWNER",
    "MASTER",
    "SCRUM", 
    "TEAM",
    "USER", 
    "STORY",
    "SPRINT",
    "PRODUCT", 
    "BACKLOG",
    "RELEASE",
    "SPRINT",
    "TIMEBOXING",
    "BURN", 
    "DOWN", 
    "CHART",
    "TEST",
    "PAIR",
    "STANDUP", 
    "MEETING",
    "ALLIANCE",
    "ADULT",
    "AEROPLANE",
    "AIR",
    "AIRCRAFT CARRIER",
    "AIRFORCE",
    "AIRPORT",
    "ALBUM",
    "ALPHABET",
    "APPLE",
    "ARM",
    "ARMY",
    "BABY",
    "BABY",
    "BACKPACK",
    "BALLOON",
    "BANANA",
    "BANK",
    "BARBECUE",
    "BATHROOM",
    "BATHTUB",
    "BED",
    "BED",
    "BEE",
    "BIBLE",
    "BIBLE",
    "BIRD",
    "BOMB",
    "BOOK",
    "BOSS",
    "BOTTLE",
    "BOWL",
    "BOX",
    "BOY",
    "BRAIN",
    "BRIDGE",
    "BUTTERFLY",
    "BUTTON",
    "CAPPUCCINO",
    "CAR",
    "CAR-RACE",
    "CARPET",
    "CARROT",
    "CAVE",
    "CHAIR",
    "CHESS BOARD",
    "CHIEF",
    "CHILD",
    "CHISEL",
    "CHOCOLATES",
    "CHURCH",
    "CHURCH",
    "CIRCLE",
    "CIRCUS",
    "CIRCUS",
    "CLOCK",
    "CLOWN",
    "COFFEE",
    "COFFEE-SHOP",
    "COMET",
    "COMPACT DISC",
    "COMPASS",
    "COMPUTER",
    "CRYSTAL",
    "CUP",
    "CYCLE",
    "DATA BASE",
    "DESK",
    "DIAMOND",
    "DRESS",
    "DRILL",
    "DRINK",
    "DRUM",
    "DUNG",
    "EARS",
    "EARTH",
    "EGG",
    "ELECTRICITY",
    "ELEPHANT",
    "ERASER",
    "EXPLOSIVE",
    "EYES",
    "FAMILY",
    "FAN",
    "FEATHER",
    "FESTIVAL",
    "FILM",
    "FINGER",
    "FIRE",
    "FLOODLIGHT",
    "FLOWER",
    "FOOT",
    "FORK",
    "FREEWAY",
    "FRUIT",
    "FUNGUS",
    "GAME",
    "GARDEN",
    "GAS",
    "GATE",
    "GEMSTONE",
    "GIRL",
    "GLOVES",
    "GOD",
    "GRAPES",
    "GUITAR",
    "HAMMER",
    "HAT",
    "HIEROGLYPH",
    "HIGHWAY",
    "HOROSCOPE",
    "HORSE",
    "HOSE",
    "ICE",
    "ICE-CREAM",
    "INSECT",
    "JET FIGHTER",
    "JUNK",
    "KALEIDOSCOPE",
    "KITCHEN",
    "KNIFE",
    "LEATHER JACKET",
    "LEG",
    "LIBRARY",
    "LIQUID",
    "MAGNET",
    "MAN",
    "MAP",
    "MAZE",
    "MEAT",
    "METEOR",
    "MICROSCOPE",
    "MILK",
    "MILKSHAKE",
    "MIST",
    "MONEY",
    "MONSTER",
    "MOSQUITO",
    "MOUTH",
    "NAIL",
    "NAVY",
    "NECKLACE",
    "NEEDLE",
    "ONION",
    "PAINTBRUSH",
    "PANTS",
    "PARACHUTE",
    "PASSPORT",
    "PEBBLE",
    "PENDULUM",
    "PEPPER",
    "PERFUME",
    "PILLOW",
    "PLANE",
    "PLANET",
    "POCKET",
    "POST-OFFICE",
    "POTATO",
    "PRINTER",
    "PRISON",
    "PYRAMID",
    "RADAR",
    "RAINBOW",
    "RECORD",
    "RESTAURANT",
    "RIFLE",
    "RING",
    "ROBOT",
    "ROCK",
    "ROCKET",
    "ROOF",
    "ROOM",
    "ROPE",
    "SADDLE",
    "SALT",
    "SANDPAPER",
    "SANDWICH",
    "SATELLITE",
    "SCHOOL",
    "SEX",
    "SHIP",
    "SHOES",
    "SHOP",
    "SHOWER",
    "SIGNATURE",
    "SKELETON",
    "SLAVE",
    "SNAIL",
    "SOFTWARE",
    "SOLID",
    "SPACE SHUTTLE",
    "SPECTRUM",
    "SPHERE",
    "SPICE",
    "SPIRAL",
    "SPOON",
    "SPORTS-CAR",
    "SPOT LIGHT",
    "SQUARE",
    "STAIRCASE",
    "STAR",
    "STOMACH",
    "SUN",
    "SUNGLASSES",
    "SURVEYOR",
    "SWIMMING POOL",
    "SWORD",
    "TABLE",
    "TAPESTRY",
    "TEETH",
    "TELESCOPE",
    "TELEVISION",
    "TENNIS RACQUET",
    "THERMOMETER",
    "TIGER",
    "TOILET",
    "TONGUE",
    "TORCH",
    "TORPEDO",
    "TRAIN",
    "TREADMILL",
    "TRIANGLE",
    "TUNNEL",
    "TYPEWRITER",
    "UMBRELLA",
    "VACUUM",
    "VAMPIRE",
    "VIDEOTAPE",
    "VULTURE",
    "WATER",
    "WEAPON",
    "WEB",
    "WHEELCHAIR",
    "WINDOW",
    "WOMAN",
    "WORM",
    "X-RAY"];
    return words[Math.floor((Math.random()*words.length))];
  }
  
  $scope.newGame = function(word) {
    $scope.lives = 5;
    $scope.usedCharacters = [];
    $scope.targetWord = word;
    $scope.targetLeft = word;
    $scope.placeholderText = word.replace(/./ig,"_").split('');
    $scope.gameStarted = true;
  }
  
  $scope.enterCharacter = function(c) {
    if (!c.length) { return;}
    var c = c.toUpperCase(), charRegex = new RegExp(c,"ig"), index;
    if ($scope.targetWord.match(charRegex)){
      index = $scope.targetLeft.indexOf(c);
      while (index >= 0){
        $scope.targetLeft= $scope.targetLeft.replace(c,'_');
        $scope.placeholderText[index] = c;
        index = $scope.targetLeft.indexOf(c)
      }
    }
    else if (!contains($scope.usedCharacters,c)){
      $scope.lives -= 1;
      $scope.usedCharacters.push(c);
    }
    $scope.inputText = "";
    $scope.hasWon = $scope.isWin();
  }

  $scope.displayHearts = function(){
    return new Array($scope.lives);
  }

  $scope.isWin = function() {
    return ($scope.lives > 0 && $scope.placeholderText.join('') == $scope.targetWord);
  }

  $scope.isLose = function() {
    return ($scope.lives < 1 && $scope.gameStarted);
  }
}
